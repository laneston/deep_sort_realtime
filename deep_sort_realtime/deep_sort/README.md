




# 余弦距离计算公式变量详解

## 公式定义:


$$cosinedistance=1-\cos{θ}=1-\frac{a⋅b}{∥a∥∥b∥}$$

其中：

$​​a$ 和 $b​$​：待比较的两个向量，可以是文本特征向量、图像像素向量等
。
$​​a⋅b​$​：向量点积（内积），计算方式为各维度分量乘积之和，即


$$a⋅b=\sum_{i=1}^{n}{{{a}_{i⋅}{b}_{i}}}$$


$∥a∥$ $∥b∥$ ：向量的模长（L2范数），计算公式为：

$$∥a∥=\sqrt{\sum_{i=1}^{n}{{{a}_{i}^{2}}}}$$


​​cos(θ)​​：向量夹角的余弦值，反映方向一致性，值域为 [−1,1]

## 关键点解析

​向量标准化​：若向量未归一化，模长会影响结果。归一化后公式简化为：
$cosinedistance=1−{a}_{norm}⋅{b}_{norm}$
其中${a}_{norm}=\frac{a}{∥a∥}$


## 关键代码解析


```
        a = np.asarray(a) / np.linalg.norm(a, axis=1, keepdims=True)
        b = np.asarray(b) / np.linalg.norm(b, axis=1, keepdims=True)
```

`np.asarray(a)`将输入数据 a 转换为NumPy数组（ndarray）。若 a 本身是NumPy数组且满足数据类型和存储顺序要求，则直接返回原数组（无复制开销）。


`np.linalg.norm(a, axis=1, keepdims=True)`计算数组的L2范数（默认）。此处指定 axis=1，表示对每行计算范数；keepdims=True 保持结果维度与输入一致，便于广播操作。


```
1.0 - np.dot(a, b.T)
```

功能​：计算矩阵乘法或向量内积，其中 b.T 表示对矩阵 b 进行转置。a 和 b 必须是 numpy 数组。a 的列数需等于 b.T 的行数（即 b 的列数）


# 欧氏距离

## ​定义与公式​

欧氏距离（Euclidean Distance）是欧几里得空间中两点之间的直线距离，其数学原理基于勾股定理的推广。对于n维空间中的两个点 $P({p}_{1},{p}_{2},...,{p}_{n})$ 和 $Q({q}_{1},{q}_{2},...,{q}_{n})$
，其欧氏距离公式为：

$$d(P,Q)=\sqrt{{\sum_{i=1}^{n}{{({{p}_{i}}-{{q}_{i}})}^{2}}}}$$

## 代码解析

```
    a, b = np.asarray(a), np.asarray(b)
```

- ​作用​：将输入对象 a 和 b 强制转换为 NumPy 数组。
- ​函数解析​：`np.asarray` 可将列表、元组等数组类对象转换为 `ndarray`。若输入已为NumPy数组且满足 `dtype` 和 `order` 要求，​不复制数据，直接返回原数组引用，否则创建新数组。
- ​意义​：统一数据结构，便于后续矩阵运算。


```
    if len(a) == 0 or len(b) == 0:
        return np.zeros((len(a), len(b)))
```

- ​作用​：检测输入数组是否为空，若为空则返回全零矩阵。
- ​解析​：
  - `len(a)` 获取数组行数（若为二维数组）。
  - 避免后续计算因空输入导致异常，确保代码鲁棒性。




```        
    a2, b2 = np.square(a).sum(axis=1), np.square(b).sum(axis=1)
```

- 函数解析​：
  - np.square(x)：对数组元素逐项平方（数学意义：消除负值影响）。
  - .sum(axis=1)：沿行方向求和，得到每个样本的特征平方和​（如样本向量模长平方）。
- ​输出​：
  - a2：形状 `(M,)`，表示 a 的每行（样本）的平方和。
  - b2：形状 `(N,)`，表示 b 的每行（样本）的平方和。



```
    r2 = -2.0 * np.dot(a, b.T) + a2[:, None] + b2[None, :]
```


$${{∥{{a}_{i}}-{{b}_{j}}∥}^{2}}=\sum_{k=1}^{d}{{{({{a}_{ik}}-{{b}_{jk}})}^{2}}}=-2⋅{{a}_{i}}⋅{{b}_{j}^{T}}+{∥{{a}_{i}}∥}^{2}+{∥{{b}_{i}}∥}^{2}$$

- ​函数解析​：
  - `np.dot(a, b.T)`：计算 a 和 b 行向量的点积矩阵，形状 (M, N)。
  - `a2[:, None]` 和 `b2[None, :]`：通过广播机制将一维数组扩展为 `(M, 1)` 和 `(1, N)`，使相加时自动对齐为 `(M, N)` 矩阵。
- ​意义​：通过矩阵运算避免显式循环，显著提升计算效率（时间复杂度从 O(MN) 优化至矩阵操作）。



```
    r2 = np.clip(r2, 0.0, float(np.inf))
```


- 作用​：将矩阵中的负值截断为0，确保欧氏距离平方非负。
- ​函数解析​： `np.clip` 将输入数组元素限制在 `[0.0, +∞)` 范围内，避免因浮点误差导致的微小负值影响后续操作（如开平方）。
- ​意义​：增强数值稳定性，符合欧氏距离的物理意义。














